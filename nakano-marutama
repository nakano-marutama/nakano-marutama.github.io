<!DOCTYPE html>
<html>
<head>
<base target="_top">
<style>
    /* ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºã‚’æ•´ãˆã‚‹ãŸã‚ã®CSS */
    body { font-family: sans-serif; margin: 20px; }
    h1 { color: #333; }
    table { border-collapse: collapse; width: 100%; max-width: 1200px; margin: 20px 0; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; font-size: 11pt; white-space: nowrap; } 
    /* ãƒ˜ãƒƒãƒ€ãƒ¼å›ºå®š */
    th { background-color: #e0e0e0; position: sticky; top: 0; z-index: 10; } 
    .name-cell { text-align: left; font-weight: bold; } /* æ°åã‚»ãƒ« */
    /* ä¼‘ã¿ï¼ˆ/ï¼‰ã®ã‚»ãƒ«ã‚’å¼·èª¿ */
    .vacation-cell { background-color: #ffdddd; font-weight: bold; } 
    /* æ—¥ä»˜è¡Œã®ãƒ˜ãƒƒãƒ€ãƒ¼è‰² */
    .date-row th { 
        background-color: #cccccc; 
        padding-top: 4px; 
        padding-bottom: 4px;
    } 
</style>
</head>
<body>
    <h1>èª­ã¿è¾¼ã¿ä¸­...</h1>
    <div id="scheduleTable">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

<script>
    // ğŸŒŸ ã€é‡è¦ã€‘ã‚¦ã‚§ãƒ–ã«å…¬é–‹ã—ãŸCSVå½¢å¼ã®URLã«ç½®ãæ›ãˆã¦ãã ã•ã„
    const PUBLIC_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSwCeHjOxhWiJlqesbnn4jQ-sL01WKbu0ynyV_spXfBRLUBsjKaX0mFumn_J6NDgHtTnwM9TEp5EBTe/pub?gid=0&single=true&output=csv'; 

    // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ã€å…¬é–‹ CSV ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
    window.onload = function() {
        fetchDataFromCSV(PUBLIC_CSV_URL)
            .then(data => {
                if (data.error) {
                    showError({ message: data.error });
                } else {
                    displayData(data);
                }
            })
            .catch(error => {
                showError({ message: `ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}` });
            });
    };

    /**
     * å…¬é–‹ CSV URL ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€æ§‹é€ åŒ–ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹é–¢æ•°
     */
    async function fetchDataFromCSV(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTPã‚¨ãƒ©ãƒ¼: ${response.status} - å…¬é–‹URLã®ç¢ºèªãŒå¿…è¦ã§ã™ã€‚`);
            }
            const csvText = await response.text();

            // CSVã‚’è¡Œã¨åˆ—ã«åˆ†å‰²ï¼ˆéå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ãƒ¼ã‚¹å‡¦ç†ï¼‰
            // æ³¨æ„: ã‚»ãƒ«å†…ã«ã‚«ãƒ³ãƒãŒå«ã¾ã‚Œã‚‹ã¨æ­£ç¢ºã«ãƒ‘ãƒ¼ã‚¹ã§ãã¾ã›ã‚“ãŒã€å…ƒã®GASãƒ­ã‚¸ãƒƒã‚¯ã‚’æ¨¡å€£ã—ã¾ã™ã€‚
            const rows = csvText.trim().split('\n').map(row => row.split(','));
            
            if (rows.length < 6) {
                 return { error: 'CSVãƒ‡ãƒ¼ã‚¿ãŒæœŸå¾…ã•ã‚Œã‚‹è¡Œæ•°ã«æº€ãŸãªã„ãŸã‚ã€ãƒ‘ãƒ¼ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒæ­£ã—ãå…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚' };
            }

            // ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå…ƒã®GASã®getScheduleData()ã‚’ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰
            // B1 (rows[0][1]) ãŒæœˆåº¦
            const monthValue = rows[0][1].trim(); 
            // A4:AF4 (rows[3]) ãŒæ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼
            const dateHeader = rows[3].map(cell => cell.trim()); 
            // A5:AF5 (rows[4]) ãŒæ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼
            const header = rows[4].map(cell => cell.trim()); 
            
            // A6ä»¥é™ (rows.slice(5)) ãŒãƒ‡ãƒ¼ã‚¿æœ¬ä½“
            const dataBody = rows.slice(5) 
                // 1åˆ—ç›®ï¼ˆæ°åï¼‰ãŒç©ºã®è¡Œã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                .filter(row => row[0] && row[0].trim() !== '')
                // å…¨ã¦ã®ã‚»ãƒ«ã‚’ãƒˆãƒªãƒŸãƒ³ã‚°
                .map(row => row.map(cell => cell.trim()));

            return {
                month: monthValue, 
                dateHeader: dateHeader, 
                header: header, 
                data: dataBody 
            };

        } catch (e) {
            return { error: `CSVãƒ‘ãƒ¼ã‚¹å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${e.message}` };
        }
    }

    /**
     * å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’HTMLãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
     */
    function displayData(scheduleData) {
        const tableDiv = document.getElementById('scheduleTable');
        if (!scheduleData || !scheduleData.data.length) {
            tableDiv.innerHTML = '<p>è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
            return;
        }
        
        // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–° (B1ã‚»ãƒ«ã®å€¤ã‚’ä½¿ç”¨)
        document.querySelector('h1').textContent = `${scheduleData.month} ä¼‘ã¿å¸Œæœ›ç¢ºèª`; 
        
        let html = '<table><thead>';
        
        // æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ (A4ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿)
        html += '<tr class="date-row">';
        scheduleData.dateHeader.forEach(d => {
            const displayValue = d || '';
            html += `<th>${displayValue}</th>`;
        });
        html += '</tr>';

        // æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆæ°å + æ›œæ—¥ï¼‰ã®ç”Ÿæˆ (A5ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿)
        html += '<tr>';
        scheduleData.header.forEach(h => {
            const displayValue = h || '';
            html += `<th>${displayValue}</th>`;
        });
        html += '</tr></thead>';
        
        // ãƒ‡ãƒ¼ã‚¿è¡Œã®ç”Ÿæˆ
        html += '<tbody>';
        scheduleData.data.forEach(row => {
            html += '<tr>';
            row.forEach((cell, cellIndex) => {
                const cellTextStr = cell.toString();
                
                if (cellIndex === 0) {
                    // æœ€åˆã®åˆ—ï¼ˆåå‰ï¼‰
                    html += `<td class="name-cell">${cellTextStr}</td>`;
                } else {
                    // 2åˆ—ç›®ä»¥é™ï¼ˆã‚·ãƒ•ãƒˆæƒ…å ±ï¼‰
                    // ã€Œ/ã€ã¨å®Œå…¨ã«ä¸€è‡´ã™ã‚‹å ´åˆã®ã¿å¼·èª¿
                    const cellClass = cellTextStr === '/' ? ' class="vacation-cell"' : ''; 
                    html += `<td${cellClass}>${cellTextStr}</td>`; 
                }
            });
            html += '</tr>';
        });
        html += '</tbody></table>';

        tableDiv.innerHTML = html;
    }
    
    /**
     * ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ãŸå ´åˆã«ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
     */
    function showError(error) {
        document.getElementById('scheduleTable').innerHTML = 
            `<p style="color: red; font-size: 14pt;">ğŸš¨ ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ ğŸš¨</p>
             <p>ä»¥ä¸‹ã®ç‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:</p>
             <ul>
               <li>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒ**ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€â†’ã€Œå…±æœ‰ã€â†’ã€Œã‚¦ã‚§ãƒ–ã«å…¬é–‹ã€**ã§**CSVå½¢å¼**ã§å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‹</li>
               <li>HTMLå†…ã® **PUBLIC_CSV_URL** ãŒæ­£ã—ã„URLã«ç½®ãæ›ã‚ã£ã¦ã„ã‚‹ã‹</li>
               <li>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${error.message}</li>
             </ul>`;
    }
</script>
</body>
</html>
